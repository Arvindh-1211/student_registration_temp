version: '3.1'

services:
  application-portal-web:
    image: nginx
    container_name: application-portal-web
    ports:
      - 8080:80
    command: ["/usr/sbin/nginx", "-g", "daemon off;"]
    volumes:
      - ./frontend/build:/usr/share/nginx/html
      - ./nginx.conf:/etc/nginx/nginx.conf

  application-portal-server:
    image: node
    container_name: application-portal-server
    ports:
      - 8000:8000
    working_dir: /app
    command: ["sh", "-c", "npm install && node server.js"]
    volumes:
      - ./server/server.js:/app/server.js
      - ./server/src:/app/src
      - ./server/.env:/app/.env
      - ./server/package.json:/app/package.json
