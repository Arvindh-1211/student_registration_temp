version: '3.1'

services:
  bitadmissions:
    container_name: bitadmissions.bitsathy.ac.in
    build:
      context: .
      dockerfile: Dockerfile
    # image: nginx
    # ports:
    #  - 8080:80
    # command: ["/usr/sbin/nginx", "-g", "daemon off;"]
    # volumes:
    #   - ./frontend/build:/usr/share/nginx/html
    #   - ./nginx.conf:/etc/nginx/nginx.conf

    labels:
      - com.centurylinklabs.watchtower.enable=true
      - traefik.enable=true

      - traefik.http.routers.bitadmissions.rule=Host(bitadmissions.bitsathy.ac.in)
      - traefik.http.routers.bitadmissions.tls=true
      - traefik.http.routers.bitadmissions.tls.certresolver=lets-encrypt
      # authenticate all requests before passing it to the backend servers
      #- traefik.http.routers.bip.middlewares=google-oauth2@file

  bitadmissions.bitsathy.ac.in-server:
    image: node
    container_name: bitadmissions.bitsathy.ac.in-server
    ports:
      - 9000:9000
    working_dir: /app
    command: ["sh", "-c", "npm install && node server.js"]
    volumes:
      - ./backend/server.js:/app/server.js
      - ./backend/src:/app/src
      - ./backend/.env:/app/.env
      - ./backend/package.json:/app/package.json